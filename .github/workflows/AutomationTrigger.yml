name: Run Selenium Tests on Push

on:
  push:
    branches:
      - Testing
  workflow_dispatch: # Trigger the workflow manually

jobs:
  run-selenium-tests:
    runs-on: windows-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    - name: Set up Java
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: Cache Maven Dependencies
      uses: actions/cache@v3
      with:
        path: ~/.m2
        key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
        restore-keys: |
          ${{ runner.os }}-m2-

    - name: Install Maven Dependencies
      run: mvn clean install -f nggi-automation/pom.xml

    - name: Install Microsoft Edge Browser
      run: |
        choco install microsoft-edge -y

    - name: Install Edge WebDriver
      run: |
        choco install microsoft-edge-webdriver -y

    - name: Verify WebDriver Installation
      run: |
        echo "WebDriver location:"
        dir "C:\SeleniumWebDrivers\EdgeDriver\"

    - name: Run Selenium Tests with TestNG
      run: |
        mvn test -f nggi-automation/pom.xml -Dsurefire.suiteXmlFiles=nggi-automation/testng.xml

    - name: Archive Test Results
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: selenium-test-results
        path: nggi-automation/target/surefire-reports/*